<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ideology Diagnosis System</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        :root {
            --color-bg: #050505;
            --color-text: #e0e6ed;
            --color-accent: #64ffda;
            --color-dim: #4a5568;
            
            /* Type Colors */
            --color-a: #ff4757; /* å›å¸°æ·˜æ±° Red */
            --color-b: #2ed573; /* å…±å‘½åŒ…æ‘‚ Green */
            --color-c: #1e90ff; /* é©å¿œé€²è»¢ Blue */
            --color-d: #a4b0be; /* ç„¡å·®ç·è³ª Gray */

            --font-main: 'Noto Sans JP', sans-serif;
            --font-mono: 'Share Tech Mono', monospace;

            /* Default sizes (will be updated by JS) */
            --container-width: 900px;
            --btn-height: 60px;
            --font-scale: 1;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--color-bg);
            color: var(--color-text);
            font-family: var(--font-main);
            min-height: 100vh; /* height: 100vh ã‹ã‚‰å¤‰æ›´ */
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Desktop Mode: Immersive (No Scroll) */
        body.mode-desktop {
            height: 100vh;
            overflow: hidden;
        }

        /* Mobile Mode: Scrollable */
        body.mode-mobile {
            height: auto;
            overflow-y: auto;
            align-items: flex-start; /* Top align for scrolling content */
            padding: 2rem 0;
        }

        /* Scanline effect */
        .scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 100;
        }

        .container {
            width: 100%;
            max-width: var(--container-width);
            padding: 2rem;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: max-width 0.5s ease;
            /* Glassmorphism subtle */
            background: rgba(255, 255, 255, 0.01);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        body.mode-desktop .container {
            height: 90vh;
        }

        body.mode-mobile .container {
            height: auto;
            min-height: 80vh;
        }

        /* --- Screens --- */
        .screen {
            /* Position absolute is good for desktop transitions, but tricky for mobile flow */
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            padding: 2rem; 
        }

        /* Desktop: Absolute positioning for cross-fading */
        body.mode-desktop .screen {
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Mobile: Relative positioning to allow document flow */
        body.mode-mobile .screen {
            display: none; /* Hide by default */
            position: relative;
            height: auto;
            min-height: 60vh;
        }

        .screen.active {
            opacity: 1;
            visibility: visible;
        }

        body.mode-mobile .screen.active {
            display: flex;
        }


        /* --- Typography & Buttons --- */
        h1 {
            font-family: var(--font-mono);
            font-size: calc(2.5rem * var(--font-scale));
            text-transform: uppercase;
            letter-spacing: 0.2em;
            margin-bottom: 1rem;
            text-align: center;
            color: var(--color-accent);
            text-shadow: 0 0 10px rgba(100, 255, 218, 0.3);
        }

        .subtitle {
            font-size: calc(1rem * var(--font-scale));
            color: var(--color-dim);
            margin-bottom: 3rem;
            text-align: center;
            max-width: 600px;
            line-height: 1.6;
        }

        .btn {
            background: transparent;
            border: 1px solid var(--color-accent);
            color: var(--color-accent);
            padding: 1rem 3rem;
            font-size: calc(1.2rem * var(--font-scale));
            font-family: var(--font-mono);
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin: 0.5rem;
        }

        .btn:hover {
            background: var(--color-accent);
            color: var(--color-bg);
            box-shadow: 0 0 20px rgba(100, 255, 218, 0.4);
        }

        .btn-share {
            border-color: #1DA1F2; /* Twitter Blue */
            color: #1DA1F2;
        }
        
        .btn-share:hover {
            background: #1DA1F2;
            color: #ffffff;
            box-shadow: 0 0 20px rgba(29, 161, 242, 0.4);
        }

        /* --- Device Selection --- */
        .device-grid {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin-top: 2rem;
        }
        .device-card {
            border: 1px solid var(--color-dim);
            padding: 2rem;
            cursor: pointer;
            transition: 0.3s;
            text-align: center;
        }
        .device-card:hover {
            border-color: var(--color-accent);
            background: rgba(100, 255, 218, 0.05);
        }
        .device-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            display: block;
        }

        /* --- Quiz Layout --- */
        .progress-container {
            width: 100%;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }
        
        body.mode-desktop .progress-container {
            position: absolute;
            top: 0;
            left: 0;
            padding: 1rem 2rem;
            margin-bottom: 0;
        }

        .progress-bar-bg {
            width: 100%;
            height: 4px;
            background: #2d3748;
            margin-bottom: 0.5rem;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--color-accent);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--color-accent);
        }

        .question-box {
            text-align: center;
            margin-bottom: 2rem;
            width: 100%;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .question-text {
            font-size: calc(1.4rem * var(--font-scale));
            font-weight: 700;
            line-height: 1.6;
        }

        .options-grid {
            display: grid;
            gap: 10px;
            width: 100%;
            margin-bottom: 2rem;
        }
        
        /* Layout specific styles handled by JS class injection */
        body.mode-desktop .options-grid {
            grid-template-columns: repeat(5, 1fr);
        }
        body.mode-mobile .options-grid {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--color-text);
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: var(--btn-height);
        }
        
        body.mode-mobile .option-btn {
            flex-direction: row;
            justify-content: flex-start;
            padding-left: 1.5rem;
            gap: 1rem;
            text-align: left;
        }

        .option-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--color-accent);
        }

        /* --- Result --- */
        .result-content {
            display: grid;
            gap: 2rem;
            align-items: center;
            width: 100%;
            /* height: 100%; Remove fixed height for flow layout */
        }
        
        body.mode-desktop .result-content {
            grid-template-columns: 1fr 1.2fr;
            padding: 2rem;
            height: 100%;
            overflow-y: auto;
        }
        body.mode-mobile .result-content {
            grid-template-columns: 1fr;
            align-content: start;
        }

        .chart-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .chart-container {
            position: relative;
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #333 0% 100%); /* Placeholder */
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            margin-bottom: 1rem;
        }
        
        .chart-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            height: 70%;
            background: var(--color-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 2;
        }

        .result-text-area {
            padding: 1.5rem;
            background: rgba(255,255,255,0.03);
            border-left: 4px solid var(--color-dim);
            text-align: left;
        }

        /* Desktop: Internal scroll if content is too long */
        body.mode-desktop .result-text-area {
            overflow-y: auto;
            max-height: 60vh;
        }
        /* Mobile: Allow full height expansion */
        body.mode-mobile .result-text-area {
            overflow-y: visible;
            height: auto;
            max-height: none;
        }

        .legend {
            display: flex;
            gap: 0.8rem;
            justify-content: center;
            flex-wrap: wrap;
            font-size: 0.8rem;
            font-family: var(--font-mono);
        }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .legend-color { width: 8px; height: 8px; border-radius: 50%; }

    </style>
</head>
<body class="mode-desktop"> <!-- Default to desktop class for init -->

    <div class="scanline"></div>

    <div class="container" id="main-container">
        
        <!-- Screen 0: Device Selection -->
        <div id="device-screen" class="screen active">
            <h1>SYSTEM BOOT</h1>
            <p class="subtitle">SELECT INTERFACE MODE</p>
            
            <div class="device-grid">
                <div class="device-card" onclick="setMode('desktop')">
                    <span class="device-icon">ğŸ’»</span>
                    <div style="font-family: var(--font-mono); font-size: 1.2rem;">DESKTOP</div>
                    <div style="font-size: 0.8rem; color: #888; margin-top: 0.5rem;">åºƒåŸŸè¡¨ç¤º / ãƒã‚¦ã‚¹æ“ä½œ</div>
                </div>
                <div class="device-card" onclick="setMode('mobile')">
                    <span class="device-icon">ğŸ“±</span>
                    <div style="font-family: var(--font-mono); font-size: 1.2rem;">MOBILE</div>
                    <div style="font-size: 0.8rem; color: #888; margin-top: 0.5rem;">ç¸¦é•·è¡¨ç¤º / ã‚¿ãƒƒãƒæ“ä½œ</div>
                </div>
            </div>
        </div>

        <!-- Screen 1: Intro -->
        <div id="intro-screen" class="screen">
            <h1>Metalepsis_type<br>IDEOLOGY<br>PROFILER</h1>
            <p class="subtitle">
                ã‚ãªãŸã®å€«ç†è¦³ã€ä¾¡å€¤è¦³ã€ãã—ã¦ç¤¾ä¼šã¸ã®å§¿å‹¢ã‚’è§£æã—ã¾ã™ã€‚<br>
                å…¨25å•ã€‚ç›´æ„Ÿã«å¾“ã£ã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚
            </p>
            <button class="btn" onclick="startQuiz()">INITIALIZE</button>
        </div>

        <!-- Screen 2: Quiz -->
        <div id="quiz-screen" class="screen">
            <div class="progress-container">
                <div class="progress-bar-bg">
                    <div id="progress-fill" class="progress-bar-fill"></div>
                </div>
                <div style="display:flex; justify-content:space-between; font-family:var(--font-mono); font-size:0.8rem; color:var(--color-dim);">
                    <span id="section-title">SECTION 1</span>
                    <span>Q.<span id="current-q">1</span>/25</span>
                </div>
            </div>

            <div class="question-box">
                <p id="question-text" class="question-text">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>

            <div class="options-grid">
                <button class="option-btn" onclick="handleAnswer(2)">
                    <span style="font-size:1.2rem; color:var(--color-accent)">â—</span> <span>éå¸¸ã«ãã†æ€ã†</span>
                </button>
                <button class="option-btn" onclick="handleAnswer(1)">
                    <span style="font-size:1rem;">â—‹</span> <span>ãã†æ€ã†</span>
                </button>
                <button class="option-btn" onclick="handleAnswer(0)">
                    <span style="font-size:1rem; opacity:0.5">-</span> <span>ã©ã¡ã‚‰ã¨ã‚‚è¨€ãˆãªã„</span>
                </button>
                <button class="option-btn" onclick="handleAnswer(-1)">
                    <span style="font-size:1rem;">Ã—</span> <span>ãã†æ€ã‚ãªã„</span>
                </button>
                <button class="option-btn" onclick="handleAnswer(-2)">
                    <span style="font-size:1.2rem; color:var(--color-a)">âœ•</span> <span>éå¸¸ã«ãã†æ€ã‚ãªã„</span>
                </button>
            </div>
        </div>

        <!-- Screen 3: Result -->
        <div id="result-screen" class="screen">
            <div class="result-content">
                <!-- Chart Area -->
                <div class="chart-wrapper">
                    <div id="pie-chart" class="chart-container">
                        <div class="chart-overlay">
                            <span style="font-size: 0.8rem; color: #888; font-family:var(--font-mono);">CLASS</span>
                            <span id="result-code" style="font-size: 2.5rem; font-weight:bold; font-family:var(--font-mono);">--</span>
                        </div>
                    </div>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background:var(--color-a)"></div>å›å¸°æ·˜æ±°</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--color-b)"></div>å…±å‘½åŒ…æ‘‚</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--color-c)"></div>é©å¿œé€²è»¢</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--color-d)"></div>ç„¡å·®ç·è³ª</div>
                    </div>
                </div>

                <!-- Text Area -->
                <div class="result-text-area" id="result-card">
                    <div id="result-title" style="font-size: 1.4rem; font-weight: bold; margin-bottom: 0.5rem;">åˆ†æä¸­...</div>
                    <div id="result-quote" style="font-style: italic; color: #888; margin-bottom: 1rem; border-bottom: 1px solid #333; padding-bottom: 0.5rem;">...</div>
                    <div id="result-desc" style="font-size: 0.95rem; line-height: 1.8;">...</div>
                    
                    <div style="margin-top: 2rem; text-align: center; display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn" onclick="restartQuiz()" style="padding: 0.5rem 2rem; font-size: 1rem;">RESET</button>
                        <button class="btn btn-share" onclick="shareOnTwitter()" style="padding: 0.5rem 2rem; font-size: 1rem;">SHARE (X)</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- Configuration ---
    const questions = [
        // Section 1: äººãƒ»å‘½ã®ä¾¡å€¤
        { t: "ç”Ÿã¾ã‚ŒæŒã£ãŸè³‡è³ªã‚„æ‰èƒ½ã®å·®ã¯ã€ãã®äººã®é‹å‘½ã‚„å½¹å‰²ã‚’æ±ºå®šã¥ã‘ã‚‹é‡è¦ãªè¦ç´ ã§ã‚ã‚‹ã€‚", type: "A", w: 1, s: "äººãƒ»å‘½ã®ä¾¡å€¤" },
        { t: "å¼±ãè€…ãŒãã®ã¾ã¾ç”Ÿãã‚‰ã‚Œã‚‹ç¤¾ä¼šã‚ˆã‚Šã‚‚ã€å¼±ãè€…ãŒå¼·ãè€…ã¸ã¨å¤‰ã‚ã‚Œã‚‹æ‰‹åŠ©ã‘ã‚’ã™ã‚‹ç¤¾ä¼šã“ããŒå¥å…¨ã ã€‚", type: "C", w: 1, s: "äººãƒ»å‘½ã®ä¾¡å€¤" },
        { t: "ã©ã®ã‚ˆã†ãªå‡¶æ‚ªãªçŠ¯ç½ªè€…ã§ã‚ã£ã¦ã‚‚ã€ãã®å­˜åœ¨ã®æ ¹æºçš„ãªä¾¡å€¤ã¯è–äººã¨åŒã˜ã§ã‚ã‚‹ã€‚", type: "B", w: 1, s: "äººãƒ»å‘½ã®ä¾¡å€¤" },
        { t: "å€‹äººã®ã€å€‹æ€§ã€ã‚„ã€è‡ªåˆ†ã‚‰ã—ã•ã€ã¸ã®å›ºåŸ·ã“ããŒã€äººé–“ç¤¾ä¼šã«ä¸å¹¸ã‚’ã‚‚ãŸã‚‰ã™å…ƒå‡¶ã ã€‚", type: "D", w: 1, s: "äººãƒ»å‘½ã®ä¾¡å€¤" },
        { t: "ç¾ã—ã„åº­ã‚’ä¿ã¤ãŸã‚ã«ã¯ã€æ™‚ã¨ã—ã¦é›‘è‰ã‚’æŠœãã‚ˆã†ã«ã€ç¤¾ä¼šå…¨ä½“ã®ãŸã‚ã«ä¸€éƒ¨ã‚’é–“å¼•ãæ±ºæ–­ã‚‚ã‚„ã‚€ã‚’å¾—ãªã„ã€‚", type: "A", w: 1, s: "äººãƒ»å‘½ã®ä¾¡å€¤" },
        // Section 2: å€«ç†è¦³
        { t: "å¤šæ§˜ãªæ„è¦‹ã‚’èªã‚åˆã†ã“ã¨ã¯å¤§åˆ‡ã ãŒã€ãã‚ŒãŒçµè«–ã®å…ˆé€ã‚Šã‚„åœæ»ã‚’æ‹›ããªã‚‰ã€å¼·åŠ›ãªãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã§çµ±ä¸€ã™ã¹ãã ã€‚", type: "A", w: 1, s: "å€«ç†è¦³" },
        { t: "éå»ã®éã¡ã‚„æ¬ é™¥ã‚’è¨±å®¹ã™ã‚‹å„ªã—ã•ã‚ˆã‚Šã‚‚ã€ãã‚Œã‚’æŠ€è¡“ã‚„ã‚·ã‚¹ãƒ†ãƒ ã§ã€äºŒåº¦ã¨èµ·ããªã„ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹ã€ã“ã¨ã“ããŒæœ¬å½“ã®æ„›ã ã€‚", type: "C", w: 1, s: "å€«ç†è¦³" },
        { t: "èª°ã‹ãŒæ‚²ã—ã‚€ãã‚‰ã„ãªã‚‰ã€å…¨å“¡ãŒåŒã˜æ„Ÿæƒ…ã€åŒã˜å¹¸ç¦åº¦ã§ç”Ÿãã‚‰ã‚Œã‚‹ã‚ˆã†ã«èª¿æ•´ã•ã‚ŒãŸä¸–ç•Œã®æ–¹ãŒè‰¯ã„ã€‚", type: "D", w: 1, s: "å€«ç†è¦³" },
        { t: "åŠ¹ç‡ã‚„é€²åŒ–ã®ãŸã‚ã«èª°ã‹ãŒçŠ ç‰²ã«ãªã‚‹ã“ã¨ã¯ã€å€«ç†çš„ã«æ±ºã—ã¦è¨±ã•ã‚Œãªã„ã€‚", type: "B", w: 1, s: "å€«ç†è¦³" },
        { t: "ä¸–ç•ŒãŒã‚«ã‚ªã‚¹ï¼ˆæ··æ²Œï¼‰ã«é™¥ã‚‹ãã‚‰ã„ãªã‚‰ã€å³ã—ã„è¦å¾‹ã«ã‚ˆã£ã¦ç®¡ç†ã•ã‚ŒãŸé™å¯‚ã®æ–¹ãŒå¥½ã¾ã—ã„ã€‚", type: "A", w: 1, s: "å€«ç†è¦³" },
        // Section 3: ç¤¾ä¼šãƒ»çµ±æ²»
        { t: "ç¤¾ä¼šã®æ§‹æˆå“¡ã¯ã€ãã‚Œãã‚Œã®èƒ½åŠ›ã«å¿œã˜ã¦æ˜ç¢ºã«åŒºåˆ¥ãƒ»ç®¡ç†ã•ã‚Œã‚‹ã¹ãã ã€‚", type: "A", w: 1, s: "ç¤¾ä¼šãƒ»çµ±æ²»" },
        { t: "ç†æƒ³çš„ãªç¤¾ä¼šã¨ã¯ã€å…¨ã¦ã®äººé–“ãŒã€åŒã˜é¡”ã€åŒã˜æ€è€ƒã€ã‚’æŒã¡ã€å¯¾ç«‹ã®æ¦‚å¿µã™ã‚‰æ¶ˆæ»…ã—ãŸçŠ¶æ…‹ã§ã‚ã‚‹ã€‚", type: "D", w: 1, s: "ç¤¾ä¼šãƒ»çµ±æ²»" },
        { t: "ç¾çŠ¶ã®è‚‰ä½“ã‚„ç²¾ç¥ã«é™ç•Œã‚’æ„Ÿã˜ã‚‹ãªã‚‰ã°ã€æ©Ÿæ¢°åŒ–ã‚„éºä¼å­æ“ä½œã‚’è¡Œã£ã¦ã§ã‚‚ã€ã‚ˆã‚Šé«˜æ¬¡ãªå­˜åœ¨ã€ã‚’ç›®æŒ‡ã™ã¹ãã ã€‚", type: "C", w: 1, s: "ç¤¾ä¼šãƒ»çµ±æ²»" },
        { t: "å½¹ã«ç«‹ãŸãªã„ã¨æ€ã‚ã‚Œã‚‹å­˜åœ¨ã§ã‚ã£ã¦ã‚‚ã€ãã‚ŒãŒç¤¾ä¼šã¨ã„ã†ç”Ÿæ…‹ç³»ã®ä¸€éƒ¨ã¨ã—ã¦æ©Ÿèƒ½ã—ã¦ã„ã‚‹ã“ã¨ã‚’å¿˜ã‚Œã¦ã¯ãªã‚‰ãªã„ã€‚", type: "B", w: 1, s: "ç¤¾ä¼šãƒ»çµ±æ²»" },
        { t: "ä¸å¹³ç­‰ã‚’æ˜¯æ­£ã™ã‚‹ãŸã‚ã«å¯Œã‚’åˆ†é…ã™ã‚‹ã‚ˆã‚Šã€ä¸å¹³ç­‰ãã®ã‚‚ã®ãŒç„¡æ„å‘³ã«ãªã‚‹ã‚ˆã†ã€å…¨å“¡ã®ç²¾ç¥æ§‹é€ ã‚’çµ±ä¸€ã™ã‚‹æ–¹ãŒæ ¹æœ¬è§£æ±ºã«ãªã‚‹ã€‚", type: "D", w: 1, s: "ç¤¾ä¼šãƒ»çµ±æ²»" },
        // Section 4: ç•°ç‰©ãƒ»å¯¾ç«‹
        { t: "å¯¾ç«‹ã™ã‚‹ç›¸æ‰‹ã‚’èª¬å¾—ã™ã‚‹æ™‚é–“ãŒã‚ã‚‹ãªã‚‰ã€ç›¸æ‰‹ã‚’ã€è‡ªåˆ†ã¨åŒã˜è€ƒãˆã€ã«ãªã‚‹ã‚ˆã†ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼ˆæ”¹é€ ï¼‰ã—ã¦ã‚ã’ãŸæ–¹ãŒäº’ã„ã®ãŸã‚ã ã€‚", type: "C", w: 1, s: "ç•°ç‰©ãƒ»å¯¾ç«‹" },
        { t: "ç´”ç²‹ãªæ°´ã‚’æ¿ã‚‰ã›ãªã„ãŸã‚ã«ã¯ã€æœ€åˆã‹ã‚‰ä¸ç´”ç‰©ã‚’å…¥ã‚Œãªã„ã€ã‚ã‚‹ã„ã¯è¦‹ã¤ã‘æ¬¡ç¬¬å–ã‚Šé™¤ãå³æ ¼ã•ãŒå¿…è¦ã ã€‚", type: "A", w: 1, s: "ç•°ç‰©ãƒ»å¯¾ç«‹" },
        { t: "äº‰ã„ã¯ã€ç§ã€ã¨ã€ã‚ãªãŸã€ã¨ã„ã†å¢ƒç•Œç·šãŒã‚ã‚‹ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹ã€‚ãã®å¢ƒç•Œç·šã‚’æº¶ã‹ã—ã¦ã—ã¾ãˆã°å¹³å’ŒãŒè¨ªã‚Œã‚‹ã€‚", type: "D", w: 1, s: "ç•°ç‰©ãƒ»å¯¾ç«‹" },
        { t: "ç†è§£ã—åˆãˆãªã„ä»–è€…ãŒã„ãŸã¨ã—ã¦ã‚‚ã€ãã®ä¸å¿«æ„Ÿã¨å…±ã«ç”Ÿãã‚‹ã“ã¨ã“ããŒæˆç†Ÿã—ãŸç¤¾ä¼šã®å§¿ã ã€‚", type: "B", w: 1, s: "ç•°ç‰©ãƒ»å¯¾ç«‹" },
        { t: "ã€æ¬ è½ã€ã‚„ã€ç—…ã€ã¯ã€æ²»ç™‚ã—å…‹æœã™ã¹ãã‚¨ãƒ©ãƒ¼ã§ã‚ã‚Šã€ãã‚Œã‚’å—ã‘å…¥ã‚Œã¦å…±å­˜ã™ã‚‹ã®ã¯æ•—åŒ—ã«ç­‰ã—ã„ã€‚", type: "C", w: 1, s: "ç•°ç‰©ãƒ»å¯¾ç«‹" },
        // Section 5: ç©¶æ¥µã®é¸æŠ
        { t: "ä¸–ç•Œã‚’æ•‘ã†ãŸã‚ã«ã€é¸ã°ã‚ŒãŸ1000äººã€ã ã‘ã‚’æ®‹ã—ã€æ®‹ã‚Šã‚’åˆ‡ã‚Šæ¨ã¦ã‚‹ç®±èˆŸã®æ‰‰ã‚’ã€ã‚ãªãŸã¯é–‰ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚", type: "A", w: 1, s: "ç©¶æ¥µã®é¸æŠ" },
        { t: "å…¨äººé¡ã®æ„è­˜ã‚’çµ±åˆã—ã€å€‹ã‚’æ¶ˆæ»…ã•ã›ã‚‹ã“ã¨ã§æ°¸é ã®å¹³ç©ãŒå¾—ã‚‰ã‚Œã‚‹ã‚¹ã‚¤ãƒƒãƒãŒã‚ã‚‹ãªã‚‰ã€è¿·ã‚ãšæŠ¼ã™ã¹ãã ã€‚", type: "D", w: 1, s: "ç©¶æ¥µã®é¸æŠ" },
        { t: "è‡´æ­»ç‡ã®é«˜ã„ã‚¦ã‚¤ãƒ«ã‚¹ãŒè”“å»¶ã—ãŸéš›ã€äººæ¨©ã‚’ç„¡è¦–ã—ã¦ã§ã‚‚å…¨å¸‚æ°‘ã«å¼·åˆ¶çš„ã«äººä½“æ”¹é€ ï¼ˆãƒ¯ã‚¯ãƒãƒ³ä»¥ä¸Šã®èº«ä½“å¼·åŒ–ï¼‰ã‚’æ–½ã™ã¹ãã ã€‚", type: "C", w: 1, s: "ç©¶æ¥µã®é¸æŠ" },
        { t: "ãŸã¨ãˆäººé¡ãŒæ»…äº¡ã™ã‚‹ã¨ã—ã¦ã‚‚ã€èª°ã‹ã®å‘½ã‚’æ„å›³çš„ã«é¸åˆ¥ã—ãŸã‚Šã€å¼·åˆ¶çš„ã«å¤‰è³ªã•ã›ãŸã‚Šã™ã‚‹æ¨©åˆ©ã¯èª°ã«ã‚‚ãªã„ã€‚", type: "B", w: 1, s: "ç©¶æ¥µã®é¸æŠ" },
        { t: "ã€ä¸å®Œå…¨ãªã¾ã¾æ„›ã—åˆã†ä¸–ç•Œã€ã¨ã€å®Œå…¨ç„¡æ¬ ã§å­¤ç‹¬ãªä¸–ç•Œã€ã€‚é¸ã¶ãªã‚‰å‰è€…ã ã€‚", type: "B", w: 1, s: "ç©¶æ¥µã®é¸æŠ" }
    ];

    const resultsData = {
        // Pure Types
        A: { title: "å›å¸°æ·˜æ±°ä¸»ç¾©çš„æ€è€ƒ (Purist)", quote: "ã€Œç©¢ã‚ŒãªãåŸç‚¹ã¸ã€‚ãã‚ŒãŒå”¯ä¸€ã®æ•‘æ¸ˆã ã€‚ã€", desc: "ä¸–ç•ŒãŒæœ¬æ¥ã‚ã‚‹ã¹ãã€Œç¾ã—ã„ç§©åºã€ã‚’æœ›ã¿ã¾ã™ã€‚æ··æ²Œã‚’å«Œã„ã€ãŸã¨ãˆæ®‹é…·ãªæ±ºæ–­ã§ã‚ã£ã¦ã‚‚ã€å¤§ç¾©ã®ãŸã‚ã«ã¯ä¸è¦ãªã‚‚ã®ã‚’åˆ‡ã‚Šæ¨ã¦ã‚‹è¦šæ‚Ÿã‚’æŒã£ã¦ã„ã¾ã™ã€‚ç´”ç²‹æ€§ã‚’æ„›ã™ã‚‹ã‚ã¾ã‚Šã€è‡ªèº«ã‚’ã‚‚æ–­ç½ªã™ã‚‹å±ã†ã•ãŒã‚ã‚Šã¾ã™ã€‚", color: "#ff4757" },
        B: { title: "å…±å‘½åŒ…æ‘‚ä¸»ç¾©çš„æ€è€ƒ (Symbiot)", quote: "ã€Œæ¸…æ¿ä½µã›å‘‘ã¿ã€å…±ã«æ³¥ã®ä¸­ã‚’æ­©ã“ã†ã€‚ã€", desc: "ã©ã®ã‚ˆã†ãªå‘½ã‚„æ€æƒ³ã‚‚å¦å®šã—ãªã„æ…ˆæ„›ã®æŒã¡ä¸»ã§ã™ã€‚åŠ¹ç‡ã‚ˆã‚Šã‚‚ã€Œä»Šã‚ã‚‹å‘½ã€ã®å°Šå³ã‚’å„ªå…ˆã—ã¾ã™ã€‚ã—ã‹ã—ã€ãã®å„ªã—ã•ã¯æ™‚ã«å•é¡Œã‚’å…ˆé€ã‚Šã«ã—ã€å…¨å“¡å…±å€’ã‚Œã«ãªã‚‹ãƒªã‚¹ã‚¯ã‚‚å­•ã‚“ã§ã„ã¾ã™ã€‚", color: "#2ed573" },
        C: { title: "é©å¿œé€²è»¢ä¸»ç¾©çš„æ€è€ƒ (Evolver)", quote: "ã€Œå¼±ã•ã¯ç½ªã§ã¯ãªã„ã€‚ä¿®æ­£ã™ã¹ãã‚¨ãƒ©ãƒ¼ã ã€‚ã€", desc: "ç¾çŠ¶ã‚’æœªå®Œæˆã¨æ‰ãˆã€æŠ€è¡“ã‚„æ„æ€ã§é€²åŒ–ã‚’ç›®æŒ‡ã™é©æ–°è€…ã§ã™ã€‚ã€Œå¤‰ã‚ã‚‹ã“ã¨ã€ã‚’å–„ã¨ã—ã€åœæ»ã‚’æ‚ªã¨ã—ã¾ã™ã€‚é€²åŒ–ã«ã¤ã„ã¦ã„ã‘ãªã„è€…ã‚’ã€æ‚ªæ°—ãªãã€Œæ—§å¼ã€ã¨ã—ã¦å‡¦ç†ã™ã‚‹å†·å¾¹ã•ãŒæ½œã‚“ã§ã„ã¾ã™ã€‚", color: "#1e90ff" },
        D: { title: "ç„¡å·®ç·è³ªä¸»ç¾©çš„æ€è€ƒ (Equalizer)", quote: "ã€Œç§ãŒã‚ãªãŸã§ã€ã‚ãªãŸãŒç§ãªã‚‰ã€äº‰ã„ã¯èµ·ããªã„ã€‚ã€", desc: "äº‰ã„ã®æ ¹æºã§ã‚ã‚‹ã€Œå€‹ä½“å·®ã€ã‚’å¦å®šã—ã€ç©¶æ¥µã®å¹³ç­‰ã‚’æ±‚ã‚ã¾ã™ã€‚ãã‚Œã¯ç²¾ç¥ã‚„æ„è­˜ã®åŒè³ªåŒ–ã¸ã¨å‘ã‹ã„ã¾ã™ã€‚å®Œå…¨ãªå¹³å’Œã‚’ç´„æŸã—ã¾ã™ãŒã€ãã‚Œã¯ã€Œå€‹äººã®æ­»ã€ã‚’æ„å‘³ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚", color: "#a4b0be" },

        // Hybrid Types (New & Existing)
        AB: { title: "è–åŸŸå®ˆè­·ä¸»ç¾© (Guardian)", quote: "ã€Œã“ã®åº­ã®å¹³ç©ã ã‘ã¯ã€ä½•ã¨ã—ã¦ã‚‚æ­»å®ˆã™ã‚‹ã€‚ã€", desc: "ã€å›å¸°æ·˜æ±° Ã— å…±å‘½åŒ…æ‘‚ã€‘<br>å†…å´ã®è€…ã«ã¯ç„¡é™ã®æ„›ã‚’æ³¨ãã¾ã™ãŒã€å¤–æ•µã«ã¯å®¹èµ¦ãªã„æ’ä»–æ€§ã‚’ç™ºæ®ã—ã¾ã™ã€‚å®¶æ—ã‚„ä»²é–“ã‚’å®ˆã‚‹ãŸã‚ãªã‚‰é¬¼ã«ãªã‚Œã‚‹ã€é–‰é–çš„ãªæ¥½åœ’ã®ç®¡ç†è€…ã§ã™ã€‚", color: "#eebb44" },
        AC: { title: "å®Œå…¨ä¸»ç¾©çš„ç‹¬è£ (Perfectionist)", quote: "ã€Œé¸ã°ã‚ŒãŸå„ªç§€ãªè€…ãŒã€ã•ã‚‰ã«é€²åŒ–ã™ã‚‹ã€‚ã€", desc: "ã€å›å¸°æ·˜æ±° Ã— é©å¿œé€²è»¢ã€‘<br>å¼±è€…ã‚’åˆ‡ã‚Šæ¨ã¦ã€æ®‹ã£ãŸå¼·è€…ã‚’ã•ã‚‰ã«å¼·åŒ–ã—ã‚ˆã†ã¨ã™ã‚‹ã‚¨ãƒªãƒ¼ãƒˆæ€æƒ³ã€‚å¼·çƒˆãªã‚«ãƒªã‚¹ãƒæ€§ã‚’æŒã¡ã¾ã™ãŒã€å¼±è€…ã«ã¨ã£ã¦ã¯åœ°ç„ã®ã‚ˆã†ãªä¸–ç•Œã‚’ä½œã‚‹ã§ã—ã‚‡ã†ã€‚", color: "#a29bfe" },
        AD: { title: "çµ±åˆ¶å…¨ä½“ä¸»ç¾© (Totalitarian)", quote: "ã€Œä¹±ã‚Œãªãè¡Œé€²ã€‚ä¾‹å¤–ã¯è¨±ã•ã‚Œãªã„ã€‚ã€", desc: "ã€å›å¸°æ·˜æ±° Ã— ç„¡å·®ç·è³ªã€‘<br>ç§©åºç¶­æŒã®ãŸã‚ã«ã€å€‹æ€§ã‚’å¾¹åº•çš„ã«æ’é™¤ã™ã‚‹ç®¡ç†ç¤¾ä¼šã®ç†æƒ³å½¢ã€‚ã™ã¹ã¦ã®å¸‚æ°‘ãŒåŒã˜è¦æ ¼ã€åŒã˜æ€æƒ³ã§å‹•ãã€ç¾ã—ãã‚‚æã‚ã—ã„æ©Ÿæ¢°ä»•æ›ã‘ã®ä¸–ç•Œã‚’æœ›ã¿ã¾ã™ã€‚", color: "#ff6b81" },
        BC: { title: "å…¨æ•‘æ¸ˆé€²åŒ–ä¸»ç¾© (Universal Uplift)", quote: "ã€Œèª°ã‚‚ç½®ãå»ã‚Šã«ã—ãªã„ã€‚å…¨å“¡ã§ç¥ã«ãªã‚‹ã€‚ã€", desc: "ã€å…±å‘½åŒ…æ‘‚ Ã— é©å¿œé€²è»¢ã€‘<br>å¼±è€…ã‚’åˆ‡ã‚Šæ¨ã¦ã‚‹ã®ã§ã¯ãªãã€æŠ€è¡“ã‚„æ•™è‚²ã§å…¨å“¡ã‚’å¼·è€…ã¸å¼•ãä¸Šã’ã‚ˆã†ã¨ã™ã‚‹ç†æƒ³å®¶ã€‚ã‚³ã‚¹ãƒˆã¨æ™‚é–“ãŒã‹ã‹ã‚Šã™ãã€ç ´ç¶»ã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã„å¤¢ç‰©èªã§ã‚‚ã‚ã‚Šã¾ã™ã€‚", color: "#00d2d3" },
        BD: { title: "å¹³å’Œçš„åœæ» (Peace Keeper)", quote: "ã€Œã¿ã‚“ãªé•ã£ã¦ã¿ã‚“ãªã„ã„ã€‚ã§ã‚‚ã€åŒã˜ãªã‚‰ã‚‚ã£ã¨ã„ã„ã€‚ã€", desc: "ã€å…±å‘½åŒ…æ‘‚ Ã— ç„¡å·®ç·è³ªã€‘<br>äº‰ã„ã‚’æ¥µç«¯ã«æã‚Œã‚‹äº‹ãªã‹ã‚Œä¸»ç¾©ã€‚å¤šæ§˜æ€§ã‚’èªã‚ã¤ã¤ã‚‚ã€æœ¬éŸ³ã§ã¯æ³¢é¢¨ã®ç«‹ãŸãªã„å‡è³ªãªä¸–ç•Œã‚’æœ›ã‚“ã§ã„ã¾ã™ã€‚å„ªã—ã„ãƒ‡ã‚£ã‚¹ãƒˆãƒ”ã‚¢ã®ä½äººã§ã™ã€‚", color: "#55efc4" },
        CD: { title: "é›†åˆçŸ¥æ€§ä¸»ç¾© (Hive Mind)", quote: "ã€Œå€‹ã‚’æ¨ã¦ã‚ˆã€‚å…¨ã¨ãªã‚Šã¦æ°¸é ã‚’ç”Ÿãã‚ˆã€‚ã€", desc: "ã€é©å¿œé€²è»¢ Ã— ç„¡å·®ç·è³ªã€‘<br>å€‹äººã®é™ç•Œã‚’æŠ€è¡“ã§çªç ´ã—ã€æ„è­˜ã‚’çµ±åˆã™ã‚‹ã“ã¨ã§é€²åŒ–ã—ã‚ˆã†ã¨ã™ã‚‹æ€æƒ³ã€‚SFçš„ãªé›†åˆç²¾ç¥ï¼ˆãƒœãƒ¼ã‚°ã‚„ç¾¤ä½“ï¼‰ã“ããŒã€äººé¡ã®æœ€çµ‚åˆ°é”ç‚¹ã ã¨ä¿¡ã˜ã¦ã„ã¾ã™ã€‚", color: "#54a0ff" },

        NEUTRAL: { title: "ä¸­ç«‹ä¸»ç¾©çš„æ€è€ƒ (The Observer)", quote: "ã€Œä¸–ç•Œã®å¤©ç§¤ã‚’çœºã‚ã‚‹è¦³æ¸¬è€…ã€", desc: "ã©ã®æ€æƒ³ã«ã‚‚ç†è§£ã‚’ç¤ºã—ã€åŒæ™‚ã«è·é›¢ã‚’ç½®ã„ã¦ã„ã¾ã™ã€‚ãƒãƒ©ãƒ³ã‚µãƒ¼ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ãŒã€æ±ºæ–­ã‚’ä¸‹ã›ãšæ™‚ä»£ã®æ³¢ã«æµã•ã‚Œã‚‹ã ã‘ã®å­˜åœ¨ã«ãªã‚‹å±é™ºæ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚", color: "#ffffff" }
    };

    // --- State ---
    let currentQIndex = 0;
    let scores = { A: 0, B: 0, C: 0, D: 0 };
    let currentMode = 'desktop';

    // --- DOM Elements ---
    const deviceScreen = document.getElementById('device-screen');
    const introScreen = document.getElementById('intro-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const body = document.body;
    const container = document.getElementById('main-container');

    // --- UI Logic ---
    function setMode(mode) {
        currentMode = mode;
        body.className = `mode-${mode}`;
        const root = document.documentElement;

        if (mode === 'mobile') {
            root.style.setProperty('--container-width', '450px');
            root.style.setProperty('--btn-height', '80px');
            root.style.setProperty('--font-scale', '0.9');
        } else {
            root.style.setProperty('--container-width', '900px');
            root.style.setProperty('--btn-height', '60px');
            root.style.setProperty('--font-scale', '1');
        }

        switchScreen(deviceScreen, introScreen);
    }

    function switchScreen(from, to) {
        // Different Transition for Mobile (Simple fade-in) vs Desktop (Crossfade)
        if (currentMode === 'mobile') {
            // For mobile, we just hide/show to avoid position absolute conflicts
            from.classList.remove('active');
            from.style.opacity = 0;
            
            to.classList.add('active');
            gsap.fromTo(to, {opacity: 0}, {opacity: 1, duration: 0.5});
        } else {
            // Desktop standard animation
            gsap.to(from, {
                opacity: 0, 
                duration: 0.3, 
                onComplete: () => {
                    from.classList.remove('active');
                    to.classList.add('active');
                    gsap.fromTo(to, {opacity: 0, scale: 0.95}, {opacity: 1, scale: 1, duration: 0.5, ease: "power2.out"});
                }
            });
        }
    }

    // --- Quiz Logic ---
    function startQuiz() {
        currentQIndex = 0;
        scores = { A: 0, B: 0, C: 0, D: 0 };
        switchScreen(introScreen, quizScreen);
        renderQuestion();
    }

    function renderQuestion() {
        const q = questions[currentQIndex];
        const qText = document.getElementById('question-text');
        
        gsap.fromTo(qText, { opacity: 0, x: 20 }, { opacity: 1, x: 0, duration: 0.4 });

        qText.innerText = q.t;
        document.getElementById('section-title').innerText = `SEC.${Math.floor(currentQIndex/5) + 1}: ${q.s}`;
        document.getElementById('current-q').innerText = currentQIndex + 1;
        
        const progress = ((currentQIndex) / questions.length) * 100;
        document.getElementById('progress-fill').style.width = `${progress}%`;
    }

    function handleAnswer(value) {
        // Guard clause for safety against double-clicks at the end of the quiz
        if (currentQIndex >= questions.length) return;

        const q = questions[currentQIndex];
        scores[q.type] += (value * q.w);

        currentQIndex++;
        if (currentQIndex < questions.length) {
            renderQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        document.getElementById('progress-fill').style.width = '100%';

        // Chart Data Calculation
        let chartData = {
            A: Math.max(0, scores.A + 10),
            B: Math.max(0, scores.B + 10),
            C: Math.max(0, scores.C + 10),
            D: Math.max(0, scores.D + 10)
        };
        const total = Object.values(chartData).reduce((a, b) => a + b, 0) || 1;
        
        // Sorting for Winner Determination
        let sorted = Object.keys(scores).sort((a, b) => scores[b] - scores[a]);
        let first = sorted[0];
        let second = sorted[1];
        let diff = scores[first] - scores[second];

        // Standard Deviation for Neutral
        const values = Object.values(scores);
        const mean = values.reduce((a, b) => a + b) / 4;
        const sd = Math.sqrt(values.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / 4);
        
        let resultKey = first;

        if (sd < 2.5) {
            resultKey = "NEUTRAL";
        } else if (diff <= 5) {
            // Create Hybrid Key (alphabetical order ensures AB, AC etc.)
            let hybrid = [first, second].sort().join("");
            if (resultsData[hybrid]) {
                resultKey = hybrid;
            }
        }

        const data = resultsData[resultKey] || resultsData[first];

        // Render Result
        switchScreen(quizScreen, resultScreen);
        
        // Chart Animation
        const pA = (chartData.A / total) * 100;
        const pB = (chartData.B / total) * 100;
        const pC = (chartData.C / total) * 100;
        const pD = (chartData.D / total) * 100;

        const chartObj = { a: 0, b: 0, c: 0, d: 0 };
        gsap.to(chartObj, {
            a: pA, b: pB, c: pC, d: pD,
            duration: 1.5,
            ease: "power2.out",
            onUpdate: () => {
                const stops = [
                    `var(--color-a) 0% ${chartObj.a}%`,
                    `var(--color-b) ${chartObj.a}% ${chartObj.a + chartObj.b}%`,
                    `var(--color-c) ${chartObj.a + chartObj.b}% ${chartObj.a + chartObj.b + chartObj.c}%`,
                    `var(--color-d) ${chartObj.a + chartObj.b + chartObj.c}% 100%`
                ];
                document.getElementById('pie-chart').style.background = `conic-gradient(from 0deg, ${stops.join(', ')})`;
            }
        });

        // DOM Updates
        document.getElementById('result-code').innerText = resultKey;
        document.getElementById('result-code').style.color = data.color;
        
        const rTitle = document.getElementById('result-title');
        const rQuote = document.getElementById('result-quote');
        const rDesc = document.getElementById('result-desc');
        const rCard = document.getElementById('result-card');

        rTitle.innerText = data.title;
        rTitle.style.color = data.color;
        rCard.style.borderLeftColor = data.color;
        
        rQuote.innerHTML = data.quote;
        rDesc.innerHTML = data.desc;

        gsap.from([rCard], { y: 30, opacity: 0, duration: 0.8, delay: 0.2 });
    }

    function shareOnTwitter() {
        const title = document.getElementById('result-title').innerText;
        const quote = document.getElementById('result-quote').innerText;
        
        const text = `ã€Mtps_æ€æƒ³è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ ã€‘\nè¨ºæ–­çµæœ: ${title}\n${quote}\n\nã‚ãªãŸã®æ€æƒ³ã‚’è§£æã—ã¾ã™ã€‚`;
        const hashtags = "Mtpsæ€æƒ³è¨ºæ–­";
        const url = "https://unknownthedeltia.github.io/mip.github.io";

        const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&hashtags=${hashtags}&url=${encodeURIComponent(url)}`;
        
        window.open(tweetUrl, '_blank');
    }

    function restartQuiz() {
        switchScreen(resultScreen, deviceScreen);
    }
</script>
</body>
</html>
